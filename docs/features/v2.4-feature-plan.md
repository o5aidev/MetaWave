# v2.4 新機能開発計画

## 実装目的
- **データエクスポート**: ユーザーデータの外部共有・バックアップ
- **プッシュ通知**: 記録リマインダーとパターン検出通知
- **ウィジェット**: ホーム画面への感情状況表示

## 実装予定

### 1. データエクスポート機能

#### 機能要件
- JSON形式でのエクスポート
- CSV形式でのエクスポート
- メモ、感情データ、パターン分析結果の含む
- 暗号化オプション
- AirDrop、メール、ファイルアプリでの共有

#### 実装内容
```
DataExportService.swift
- exportToJSON() -> Data
- exportToCSV() -> Data
- shareData(method: ShareMethod)
- encryptExport(data: Data) -> Data
```

#### UI実装
- SettingsViewにエクスポートボタンを追加
- ExportOptionsView（形式選択）
- 共有シートの表示

### 2. プッシュ通知

#### 機能要件
- 毎日の記録リマインダー
- パターン検出時の通知
- 感情トレンドの変化通知
- 通知時間のカスタマイズ

#### 実装内容
```
NotificationService.swift
- scheduleDailyReminder(time: Date)
- sendPatternDetectionNotification()
- sendTrendAlertNotification()
- requestNotificationPermission()
```

#### UI実装
- SettingsViewに通知設定を追加
- NotificationSettingsView
- 通知プレビュー

### 3. ウィジェット

#### 機能要件
- 小型ウィジェット: 現在の感情状況
- 中型ウィジェット: 感情推移グラフ
- アップデート頻度: 1時間ごと
- インタラクティブ要素: 記録追加ボタン

#### 実装内容
```
Widgets/
- EmotionWidget.swift
- EmotionWidgetBundle.swift
- EmotionTimelineProvider.swift
```

#### UI実装
- SwiftUI ウィジェット
- WidgetKit統合
- TimelineProvider実装

## 技術仕様

### エクスポート形式

#### JSON形式
```json
{
  "version": "2.4",
  "exportDate": "2025-10-28T00:00:00Z",
  "notes": [...],
  "emotionData": [...],
  "patterns": [...],
  "predictions": [...]
}
```

#### CSV形式
```csv
timestamp,modality,content,valence,arousal,tags
2025-10-28 00:00:00,text,"Hello",0.5,0.3,"work,stress"
```

### 通知トリガー

1. **日次リマインダー**: 毎日指定時刻
2. **パターン検出**: 新しいループパターン検出時
3. **トレンド変化**: 感情トレンドが変化した時
4. **週間サマリー**: 毎週月曜日

### ウィジェットサイズ

1. **Small**: 140x140pt
   - 現在の感情スコア
   - 最新の記録数
   
2. **Medium**: 290x140pt
   - 感情スコア推移グラフ
   - 今週の統計
   
3. **Large**: 290x310pt (将来実装)
   - 詳細な分析結果
   - 推奨アクション

## 実装順序

1. **Week 1**: データエクスポート機能
   - DataExportService実装
   - UI統合
   - テスト

2. **Week 2**: プッシュ通知
   - NotificationService実装
   - 権限管理
   - 通知スケジューリング

3. **Week 3**: ウィジェット
   - WidgetKit統合
   - TimelineProvider実装
   - UI実装

## 完了条件

### 機能要件
- [ ] JSON形式エクスポート
- [ ] CSV形式エクスポート
- [ ] プッシュ通知
- [ ] ウィジェット（Small/Medium）
- [ ] 共有機能

### 非機能要件
- [ ] パフォーマンス最適化
- [ ] プライバシー配慮
- [ ] ユーザビリティ
- [ ] テストカバレッジ

## 推定実装期間
- 3週間

## 依存関係
- UserNotificationsフレームワーク
- WidgetKitフレームワーク
- ファイル共有API

