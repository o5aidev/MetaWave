# Core Data永続化実装仕様

## 実装目的
- **データ永続化**: ノートデータの永続的保存
- **ローカル処理**: 完全ローカルでのデータ管理
- **パフォーマンス**: 効率的なデータアクセス
- **スケーラビリティ**: 将来の機能拡張に対応

## データモデル

### エンティティ構成
- **Item**: 基本ノートエンティティ
  - `title`: String (タイトル)
  - `note`: String (内容)
  - `timestamp`: Date (作成日時)
- **Note**: 拡張ノートエンティティ
- **Insight**: 分析結果エンティティ

### リレーションシップ
- **Item → Note**: 1対1
- **Item → Insight**: 1対多

## 技術実装

### Persistence.swift
```swift
class PersistenceController {
    static let shared = PersistenceController()
    let container: NSPersistentContainer
    
    init(inMemory: Bool = false) {
        container = NSPersistentContainer(name: "MetaWave")
        // ローカル保存設定
    }
}
```

### データ操作
- **CRUD操作**: 作成・読み取り・更新・削除
- **検索機能**: タイトル・内容での検索
- **ソート機能**: 日時でのソート

## 設定変更

### CloudKit統合の中止
- **変更前**: `NSPersistentCloudKitContainer`
- **変更後**: `NSPersistentContainer`
- **理由**: 個人開発チームの制約

### ローカル保存設定
- **ストレージ**: ローカルSQLite
- **同期**: なし（v2.2で再検討）
- **バックアップ**: ローカルのみ

## パフォーマンス

### 最適化
- **バッチ処理**: 大量データの効率的処理
- **メモリ管理**: 適切なメモリ使用量
- **インデックス**: 検索性能の向上

### 制約
- **データサイズ**: ローカルストレージの制限
- **同期**: マルチデバイス同期なし
- **バックアップ**: 手動バックアップ必要

## リスク

### データリスク
- **データ損失**: ローカル保存のリスク
- **バックアップ**: 自動バックアップなし
- **同期**: デバイス間の同期なし

### 技術的リスク
- **スケーラビリティ**: 大量データの処理
- **パフォーマンス**: データ量増加時の性能
- **互換性**: スキーマ変更時の互換性

## 完了条件

### 機能要件
- ✅ ノートデータの永続化
- ✅ CRUD操作の実装
- ✅ 検索・ソート機能
- ✅ ローカル保存設定

### 非機能要件
- ✅ パフォーマンス最適化
- ✅ メモリ効率化
- ✅ エラーハンドリング
- ✅ データ整合性
