# 音声入力機能 (v2.1) 実装仕様

## 実装目的
- **直感的な音声入力**: マイクボタン一つで音声認識開始
- **リアルタイム認識**: 部分結果の即座表示
- **連続認識**: ユーザーがストップするまで継続
- **プライバシー保護**: 完全ローカル処理

## 画面構成

### VoiceInputView_v2.1
- **録音ボタン**: 開始/停止の切り替え
- **認識結果表示**: リアルタイムテキスト表示
- **録音時間表示**: タイマー機能
- **操作ボタン**: クリア・保存

### ContentView統合
- **マイクボタン**: 音声入力画面の表示
- **ノート保存**: 認識結果の永続化

## データ構造

### SpeechRecognitionResult
```swift
struct SpeechRecognitionResult {
    let text: String
    let confidence: Float
    let duration: TimeInterval
    let audioData: Data?
    let timestamp: Date
}
```

### 音声データの暗号化
- **AES-GCM 256**: 音声データの完全暗号化
- **Vault**: 暗号化キーの管理
- **Keychain**: セキュアなキー保存

## 技術実装

### SpeechRecognitionService
- **SFSpeechRecognizer**: 音声認識エンジン
- **AVAudioSession**: 音声録音管理
- **連続認識**: 部分結果の蓄積
- **エラーハンドリング**: 堅牢なエラー処理

### UI状態管理
- **@StateObject**: 音声認識サービスの管理
- **NotificationCenter**: 部分結果の通知
- **非同期処理**: Task/awaitによる非同期処理

## リスク

### 技術的リスク
- **オーディオフォーマット**: デバイス間の違い
- **メモリ使用量**: 音声データの蓄積
- **バッテリー消費**: 音声処理の負荷

### プライバシーリスク
- **マイク権限**: ユーザーの許可が必要
- **音声データ**: 機密情報の可能性
- **暗号化**: データ保護の重要性

## 完了条件

### 機能要件
- ✅ 音声認識の開始/停止
- ✅ リアルタイム部分結果表示
- ✅ 連続音声認識
- ✅ 音声データの暗号化
- ✅ エラーハンドリング

### 非機能要件
- ✅ 認識精度: 90%以上
- ✅ 処理時間: 3秒以内
- ✅ メモリ使用量: 100MB以内
- ✅ バッテリー消費: 10%以内/時間

### テスト要件
- ✅ 実機での動作確認
- ✅ エラーケースのテスト
- ✅ パフォーマンステスト
- ✅ セキュリティテスト
