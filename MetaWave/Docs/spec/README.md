# MetaWave iOS v2.0 - 完全実装ガイド

## 🎯 プロジェクト概要

MetaWave iOS v2.0は、Miyabi仕様に基づく「メタ認知パートナー」アプリケーションです。思考と行動を記録・分析し、認知のクセを映し出し、創造性を増幅することを目的としています。

## ✨ 主要機能

### 1. ハイブリッド入力
- **テキスト入力**: 直接テキストエディタで思考を記録
- **音声入力**: 録音 → 文字起こし → テキスト化
- **画像入力**: 将来実装予定（v2.1+）

### 2. 超・鏡（Hyper Mirror）
- **感情分析**: Valence（ポジティブ/ネガティブ）+ Arousal（覚醒度）
- **ループ検出**: 類似テーマの反復記録を自動検出
- **バイアス検出**: 確証バイアス、利用可能性バイアス等の兆候を指摘

### 3. 認知バイアス・ミラー
- **確証バイアス**: 極端な表現や感情の一貫性を検出
- **利用可能性バイアス**: 最近の出来事への過度な言及を検出
- **アンカリングバイアス**: 最初の数値への依存を検出
- **損失回避**: 損失に関する表現の頻度を分析
- **サンクコスト**: 投資・努力に関する表現を検出

### 4. 剪定（Forgetfulness）
- **価値評価**: 古さ、参照頻度、内容価値、感情、重複度を総合評価
- **自動候補**: 剪定候補の自動提示
- **手動選択**: ユーザーによる選択的削除

### 5. 完全プライバシー
- **E2E暗号化**: AES-GCM 256-bit暗号化
- **ローカル処理**: 全分析を端末内で実行
- **キーマネジメント**: iOS Keychain + CryptoKit

## 🏗️ アーキテクチャ

### モジュール構成
```
MetaWave/
├── App/                    # アプリケーションエントリーポイント
├── Modules/
│   ├── StorageKit/         # 暗号化ストレージ
│   ├── InputKit/           # 音声/テキスト/画像入力
│   ├── AnalysisKit/        # 感情/ループ/バイアス分析
│   └── InsightKit/         # 介入・提案機能
├── Services/               # プロトコル定義・統合サービス
├── Models/                 # データモデル拡張
├── Views/                  # SwiftUI画面
└── Tests/                  # ユニット・統合テスト
```

### 技術スタック
- **UI**: SwiftUI
- **データ**: CoreData + 暗号化
- **音声**: Speech Framework
- **分析**: NaturalLanguage Framework
- **暗号化**: CryptoKit
- **セキュリティ**: iOS Keychain

## 📱 画面構成

### 1. Notes（ホーム）
- ノート一覧表示
- 感情スコア可視化
- タグ管理
- 検索・フィルタ

### 2. Capture
- モダリティ選択（テキスト/音声/画像）
- リアルタイム録音
- 文字起こし表示
- タグ入力

### 3. Insights
- 分析実行ボタン
- 統計カード
- 感情トレンド
- ループ検出結果
- インサイト提案

### 4. Settings
- セキュリティ設定
- データ管理
- 分析設定
- プライバシー設定

## 🔒 セキュリティ設計

### 暗号化フロー
1. **鍵生成**: CryptoKit `SymmetricKey` (256-bit)
2. **データ暗号化**: AES-GCM
3. **安全保存**: iOS Keychain
4. **復号化**: アプリ内でのみ実行

### プライバシー保護
- 全データは端末内で処理
- 外部サーバーへの送信なし
- 暗号化後データのみiCloud同期
- 最小限の権限要求

## 🚀 パフォーマンス最適化

### 電力効率
- 低電力モード検出
- バックグラウンド処理制限
- バッチ処理による最適化

### メモリ管理
- 自動メモリ最適化
- 不要キャッシュのクリア
- メモリ警告対応

### 分析最適化
- 並列処理制限
- バッチサイズ調整
- 進捗表示

## 🧪 テスト戦略

### ユニットテスト
- Vault暗号化テスト
- 感情分析テスト
- ループ検出テスト
- バイアス検出テスト

### 統合テスト
- 完全ワークフローテスト
- パフォーマンステスト
- エラーハンドリングテスト
- データ整合性テスト

### セキュリティテスト
- 暗号化テスト
- 鍵永続化テスト
- データ整合性テスト

## 📊 データモデル

### CoreDataエンティティ

#### Note
```swift
- id: UUID
- createdAt/updatedAt: Date
- modality: text/audio/image
- contentText: String?
- audioURL/imageURL: URL?
- tags: [String]
- topicHash: String
- sentiment/arousal: Float?
- biasSignals: [BiasSignal: Float]
- loopGroupID: String?
- encNonce: Data
```

#### Insight
```swift
- id: UUID
- noteIDs: [UUID]
- kind: biorhythm/loop/bias/creativity
- payload: JSON
- createdAt: Date
```

## 🔧 開発・デプロイ

### 開発環境
- Xcode 15.0+
- iOS 17.0+
- Swift 5.9+

### ビルド設定
- Bundle ID: `com.vibe5.MetaWave`
- 開発版: `com.vibe5.MetaWave.dev`
- 署名: Automatic

### 権限設定
- マイクアクセス: 音声録音
- 音声認識: 文字起こし
- 写真ライブラリ: 画像保存（将来）

## 📈 今後の拡張

### v2.1予定機能
- 画像入力・分析
- 音声感情分析
- より高度なバイアス検出
- データ共有機能

### v2.2予定機能
- iPad対応
- Apple Watch連携
- Siriショートカット
- 高度な可視化

## 🎯 成功指標

### 技術指標
- 分析精度: 感情分析80%以上
- パフォーマンス: 100ノート分析10秒以内
- セキュリティ: 暗号化強度AES-256

### ユーザー指標
- 日次アクティブユーザー
- ノート作成頻度
- 分析結果の有用性評価

## 📝 ライセンス

このプロジェクトはMiyabi仕様に基づいて開発されています。

## 🤝 貢献

プロジェクトへの貢献は歓迎します。詳細は開発チームにお問い合わせください。

---

**MetaWave iOS v2.0** - 第二の脳を超える「メタ認知パートナー」
