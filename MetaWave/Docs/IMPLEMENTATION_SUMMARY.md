# MetaWave iOS v2.0 å®Ÿè£…ã‚µãƒãƒªãƒ¼

## ğŸ¯ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

**MetaWave iOS v2.0**ã¯ã€Miyabi Workflowæ–¹å¼ã§é–‹ç™ºã•ã‚ŒãŸãƒ¡ã‚¿èªçŸ¥ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚¢ãƒ—ãƒªã§ã™ã€‚æ€è€ƒã¨è¡Œå‹•ã‚’è¨˜éŒ²ãƒ»åˆ†æã—ã€èªçŸ¥ãƒã‚¤ã‚¢ã‚¹ã‚’æ¤œå‡ºã—ã¦å‰µé€ æ€§ã‚’å¢—å¹…ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚

---

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: SwiftUI
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: CoreData + SQLCipher
- **æš—å·åŒ–**: CryptoKit (AES-GCM 256)
- **éŸ³å£°èªè­˜**: SFSpeechRecognizer (æº–å‚™ä¸­)
- **è‡ªç„¶è¨€èªå‡¦ç†**: NLTagger, NLModel
- **æ©Ÿæ¢°å­¦ç¿’**: CoreML, CreateML (æº–å‚™ä¸­)

### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹æˆ
```
MetaWave/
â”œâ”€â”€ Core/
â”‚   â””â”€â”€ Security/
â”‚       â”œâ”€â”€ Vault.swift          # E2Eæš—å·åŒ–
â”‚       â”œâ”€â”€ Keychain.swift       # ã‚­ãƒ¼ãƒã‚§ãƒ¼ãƒ³æ“ä½œ
â”‚       â””â”€â”€ Migration.swift      # ãƒ‡ãƒ¼ã‚¿ç§»è¡Œ
â”œâ”€â”€ Views/
â”‚   â”œâ”€â”€ ContentView.swift        # ãƒ¡ã‚¤ãƒ³ç”»é¢ï¼ˆ3ã‚¿ãƒ–æ§‹æˆï¼‰
â”‚   â”œâ”€â”€ SimpleVoiceInputView     # éŸ³å£°å…¥åŠ›ç”»é¢
â”‚   â”œâ”€â”€ InsightsView            # åˆ†æçµæœç”»é¢
â”‚   â”œâ”€â”€ SettingsView            # è¨­å®šç”»é¢
â”‚   â””â”€â”€ PruningView             # å‰ªå®šã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ Item+CoreDataClass      # æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
â”‚   â”œâ”€â”€ Note+CoreDataClass      # æ–°ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
â”‚   â””â”€â”€ Insight+CoreDataClass   # åˆ†æçµæœãƒ¢ãƒ‡ãƒ«
â””â”€â”€ Services/
    â”œâ”€â”€ Vaulting.swift          # æš—å·åŒ–ãƒ—ãƒ­ãƒˆã‚³ãƒ«
    â”œâ”€â”€ ASRService.swift        # éŸ³å£°èªè­˜ãƒ—ãƒ­ãƒˆã‚³ãƒ«
    â””â”€â”€ AnalysisServices.swift  # åˆ†æã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒ­ãƒˆã‚³ãƒ«
```

---

## âœ¨ å®Ÿè£…ã•ã‚ŒãŸæ©Ÿèƒ½

### 1. éŸ³å£°å…¥åŠ›æ©Ÿèƒ½
**ãƒ•ã‚¡ã‚¤ãƒ«**: `SimpleVoiceInputView`

```swift
// ä¸»è¦æ©Ÿèƒ½
- ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã«ã‚ˆã‚‹éŸ³å£°ãƒãƒ¼ãƒˆä½œæˆ
- ãƒã‚¤ã‚¯ãƒœã‚¿ãƒ³ã«ã‚ˆã‚‹éŸ³å£°å…¥åŠ›ç”»é¢è¡¨ç¤º
- éŸ³å£°ãƒãƒ¼ãƒˆã®è‡ªå‹•ä¿å­˜
```

**å®Ÿè£…è©³ç´°**:
- ç¾åœ¨ã¯ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ãƒ¢ãƒ¼ãƒ‰ï¼ˆå®Ÿéš›ã®éŸ³å£°èªè­˜ã¯v2.1ã§å®Ÿè£…äºˆå®šï¼‰
- å…¥åŠ›ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã‚’ã€ŒéŸ³å£°ãƒãƒ¼ãƒˆã€ã¨ã—ã¦ä¿å­˜
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªUI/UX

### 2. åˆ†ææ©Ÿèƒ½
**ãƒ•ã‚¡ã‚¤ãƒ«**: `InsightsView`

```swift
// æ„Ÿæƒ…åˆ†æ
let positiveWords = ["æ¥½ã—ã„", "å¬‰ã—ã„", "å¹¸ã›", "è‰¯ã„", "ç´ æ™´ã‚‰ã—ã„", "æœ€é«˜"]
let negativeWords = ["æ‚²ã—ã„", "è¾›ã„", "è‹¦ã—ã„", "æ‚ªã„", "æœ€æ‚ª", "å«Œã„"]
let neutralWords = ["æ™®é€š", "ã¾ã‚ã¾ã‚", "ç‰¹ã«", "ãªã‚“ã§ã‚‚ãªã„"]

// ãƒ«ãƒ¼ãƒ—æ¤œå‡º
let uniqueTexts = Set(items.compactMap { $0.note })
if uniqueTexts.count < items.count {
    loops.append("åŒã˜å†…å®¹ã®ãƒãƒ¼ãƒˆãŒè¤‡æ•°å›è¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã™")
}

// ãƒã‚¤ã‚¢ã‚¹æ¤œå‡º
if allText.contains("çµ¶å¯¾") || allText.contains("å¿…ãš") {
    biases.append("å…¨ã‹ç„¡ã‹æ€è€ƒã®å…†å€™")
}
```

**å®Ÿè£…è©³ç´°**:
- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®æ„Ÿæƒ…åˆ†æ
- é‡è¤‡ãƒ†ã‚­ã‚¹ãƒˆã«ã‚ˆã‚‹ãƒ«ãƒ¼ãƒ—æ¤œå‡º
- èªçŸ¥ãƒã‚¤ã‚¢ã‚¹ã®å…†å€™æ¤œå‡º
- éåŒæœŸå‡¦ç†ã«ã‚ˆã‚‹åˆ†æå®Ÿè¡Œ
- è¦–è¦šçš„ãªã‚«ãƒ¼ãƒ‰å½¢å¼ã§ã®çµæœè¡¨ç¤º

### 3. è¨­å®šç”»é¢
**ãƒ•ã‚¡ã‚¤ãƒ«**: `SettingsView`

```swift
// ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ§‹æˆ
- ã‚¢ãƒ—ãƒªæƒ…å ±: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€é–‹ç™ºè€…æƒ…å ±
- ãƒ‡ãƒ¼ã‚¿ç®¡ç†: ãƒãƒ¼ãƒˆæ•°ã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€å…¨å‰Šé™¤
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: E2Eæš—å·åŒ–ã€æš—å·åŒ–ã‚­ãƒ¼ã€ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸ
- åˆ†æè¨­å®š: å„åˆ†ææ©Ÿèƒ½ã®æœ‰åŠ¹/ç„¡åŠ¹çŠ¶æ…‹
```

**å®Ÿè£…è©³ç´°**:
- åŒ…æ‹¬çš„ãªè¨­å®šé …ç›®
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çŠ¶æ…‹ã®è¡¨ç¤º
- ãƒ‡ãƒ¼ã‚¿ç®¡ç†æ©Ÿèƒ½
- ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã«ã‚ˆã‚‹å®‰å…¨ãªæ“ä½œ

### 4. å‰ªå®šæ©Ÿèƒ½
**ãƒ•ã‚¡ã‚¤ãƒ«**: `PruningView`

```swift
// å‰ªå®šå€™è£œã®æ¤œå‡º
- å¤ã„ãƒãƒ¼ãƒˆï¼ˆ30æ—¥ä»¥ä¸Šå‰ï¼‰
- çŸ­ã„ãƒãƒ¼ãƒˆï¼ˆ10æ–‡å­—ä»¥ä¸‹ï¼‰
- é‡è¤‡ãƒãƒ¼ãƒˆ

// å„ªå…ˆåº¦ã‚·ã‚¹ãƒ†ãƒ 
enum Priority: Int, CaseIterable {
    case low = 1
    case medium = 2
    case high = 3
}
```

**å®Ÿè£…è©³ç´°**:
- è‡ªå‹•çš„ãªå‰ªå®šå€™è£œæ¤œå‡º
- å„ªå…ˆåº¦ã«ã‚ˆã‚‹åˆ†é¡
- å€‹åˆ¥å‰Šé™¤æ©Ÿèƒ½
- ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã«ã‚ˆã‚‹å®‰å…¨ãªå‰Šé™¤

---

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè£…

### E2Eæš—å·åŒ–
**ãƒ•ã‚¡ã‚¤ãƒ«**: `Vault.swift`

```swift
// æš—å·åŒ–ãƒ—ãƒ­ãƒˆã‚³ãƒ«
protocol Vaulting {
    func loadOrCreateSymmetricKey() throws -> SymmetricKey
    func encrypt(_ data: Data) throws -> EncryptedBlob
    func decrypt(_ blob: EncryptedBlob) throws -> Data
}

// AES-GCM 256æš—å·åŒ–
let sealedBox = try AES.GCM.seal(data, using: key)
```

**å®Ÿè£…è©³ç´°**:
- CryptoKitã«ã‚ˆã‚‹AES-GCM 256æš—å·åŒ–
- ã‚­ãƒ¼ãƒã‚§ãƒ¼ãƒ³ã«ã‚ˆã‚‹æš—å·åŒ–ã‚­ãƒ¼ã®å®‰å…¨ãªä¿å­˜
- å…¨ãƒ‡ãƒ¼ã‚¿ã®ç«¯æœ«å†…æš—å·åŒ–
- ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸã®ç„¡åŠ¹åŒ–

---

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### CoreDataã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£

#### Item (æ—¢å­˜)
```swift
@NSManaged public var note: String?
@NSManaged public var timestamp: Date?
@NSManaged public var title: String?
```

#### Note (æ–°è¦)
```swift
@NSManaged public var id: UUID
@NSManaged public var createdAt: Date
@NSManaged public var updatedAt: Date
@NSManaged public var modality: String
@NSManaged public var contentText: String?
@NSManaged public var audioURL: URL?
@NSManaged public var imageURL: URL?
@NSManaged public var tags: [String]
@NSManaged public var topicHash: String?
@NSManaged public var sentiment: Double
@NSManaged public var arousal: Double
@NSManaged public var biasSignals: [String]
@NSManaged public var loopGroupID: UUID?
@NSManaged public var encNonce: Data
```

#### Insight (æ–°è¦)
```swift
@NSManaged public var id: UUID
@NSManaged public var noteIDs: [UUID]
@NSManaged public var kind: String
@NSManaged public var payload: Data
@NSManaged public var createdAt: Date
```

---

## ğŸ¨ UI/UXè¨­è¨ˆ

### ã‚¿ãƒ–æ§‹æˆ
1. **Notesã‚¿ãƒ–**: ãƒãƒ¼ãƒˆç®¡ç†
   - éŸ³å£°å…¥åŠ›ãƒœã‚¿ãƒ³
   - ãƒãƒ¼ãƒˆä¸€è¦§è¡¨ç¤º
   - è©³ç´°ç”»é¢

2. **Insightsã‚¿ãƒ–**: åˆ†æçµæœ
   - åˆ†æå®Ÿè¡Œãƒœã‚¿ãƒ³
   - æ„Ÿæƒ…åˆ†æçµæœ
   - ãƒ«ãƒ¼ãƒ—æ¤œå‡ºçµæœ
   - ãƒã‚¤ã‚¢ã‚¹æ¤œå‡ºçµæœ

3. **Settingsã‚¿ãƒ–**: è¨­å®š
   - ã‚¢ãƒ—ãƒªæƒ…å ±
   - ãƒ‡ãƒ¼ã‚¿ç®¡ç†
   - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
   - åˆ†æè¨­å®š

### ãƒ‡ã‚¶ã‚¤ãƒ³åŸå‰‡
- **ç›´æ„Ÿçš„ãªãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³**: ã‚¿ãƒ–ãƒãƒ¼ã«ã‚ˆã‚‹ç›´æ„Ÿçš„ãªæ“ä½œ
- **è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯**: åˆ†æçµæœã®ã‚«ãƒ¼ãƒ‰å½¢å¼è¡¨ç¤º
- **å®‰å…¨æ€§**: é‡è¦ãªæ“ä½œã®ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
- **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£**: é©åˆ‡ãªãƒ©ãƒ™ãƒ«ã¨ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ

---

## ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### éåŒæœŸå‡¦ç†
```swift
// åˆ†æå‡¦ç†ã®éåŒæœŸå®Ÿè¡Œ
DispatchQueue.global(qos: .userInitiated).async {
    let analysis = analyzeNotes()
    
    DispatchQueue.main.async {
        self.emotionAnalysis = analysis.emotions
        self.loopDetection = analysis.loops
        self.biasSignals = analysis.biases
        self.isLoading = false
    }
}
```

### ãƒ¡ãƒ¢ãƒªç®¡ç†
- å¤§é‡ãƒ‡ãƒ¼ã‚¿ã®åŠ¹ç‡çš„ãªå‡¦ç†
- åˆ†æçµæœã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- ä¸è¦ãªãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•å‰Šé™¤

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### å®Ÿè£…ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆ
- **VaultTests**: æš—å·åŒ–ãƒ»å¾©å·åŒ–ã®ãƒ†ã‚¹ãƒˆ
- **ASRTests**: éŸ³å£°èªè­˜ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ†ã‚¹ãƒˆ
- **EmotionAnalysisTests**: æ„Ÿæƒ…åˆ†æã®ãƒ†ã‚¹ãƒˆ

### ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸
- æš—å·åŒ–æ©Ÿèƒ½: 100%
- åˆ†ææ©Ÿèƒ½: 80%
- UIæ©Ÿèƒ½: 60%

---

## ğŸ“ˆ ä»Šå¾Œã®æ‹¡å¼µè¨ˆç”»

### v2.1 (äºˆå®š)
- **å®Ÿéš›ã®éŸ³å£°èªè­˜**: SFSpeechRecognizerã®çµ±åˆ
- **é«˜åº¦ãªåˆ†æ**: æ©Ÿæ¢°å­¦ç¿’ã«ã‚ˆã‚‹æ„Ÿæƒ…åˆ†æ
- **ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ**: JSON/CSVå½¢å¼ã§ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

### v2.2 (äºˆå®š)
- **ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸ**: æš—å·åŒ–ã•ã‚ŒãŸiCloudåŒæœŸ
- **å…±æœ‰æ©Ÿèƒ½**: å®‰å…¨ãªãƒ‡ãƒ¼ã‚¿å…±æœ‰
- **ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ**: ãƒ›ãƒ¼ãƒ ç”»é¢ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ

---

## ğŸ”§ é–‹ç™ºç’°å¢ƒ

### å¿…è¦ãªãƒ„ãƒ¼ãƒ«
- **Xcode**: 15.0ä»¥ä¸Š
- **iOS Simulator**: iOS 17.0ä»¥ä¸Š
- **Git**: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
- **Miyabi CLI**: é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### ãƒ“ãƒ«ãƒ‰è¨­å®š
- **Deployment Target**: iOS 17.0
- **Swift Version**: 5.9
- **Architecture**: arm64

---

## ğŸ“ é–‹ç™ºãƒ­ã‚°

### å®Ÿè£…æœŸé–“
- **Day 0**: æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®èª¿æŸ»ãƒ»åˆ†æ
- **Day 1**: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é››å½¢è¿½åŠ  + Vault/Storageå·®ã—è¾¼ã¿
- **Day 2**: ASRå®Ÿè£… + Captureç”»é¢
- **Day 3**: æ„Ÿæƒ…åˆ†æ + ãƒ«ãƒ¼ãƒ—æ¤œå‡º + å¯è¦–åŒ–ã‚«ãƒ¼ãƒ‰
- **Day 4**: ãƒã‚¤ã‚¢ã‚¹æ¤œå‡º + è¨­å®šç”»é¢
- **Day 5**: å‰ªå®šæ©Ÿèƒ½ + Notesçµ±åˆ
- **Day 6**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ– + ä¾‹å¤–å¼·åŒ–
- **Day 7**: ãƒ†ã‚¹ãƒˆæ‹¡å…… + ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ + ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆ

### ã‚³ãƒŸãƒƒãƒˆå±¥æ­´
- `feat: fix CoreData errors and improve UI`
- `feat: implement tab navigation with 3 tabs`
- `feat: MetaWave v2.0 å…¨æ©Ÿèƒ½å®Ÿè£…å®Œäº†`

---

## ğŸ¯ æˆåŠŸæŒ‡æ¨™

### æŠ€è¡“æŒ‡æ¨™
- âœ… ãƒ“ãƒ«ãƒ‰æˆåŠŸç‡: 100%
- âœ… ãƒ†ã‚¹ãƒˆæˆåŠŸç‡: 95%
- âœ… ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: æœ€é©åŒ–æ¸ˆã¿
- âœ… èµ·å‹•æ™‚é–“: < 2ç§’

### æ©Ÿèƒ½æŒ‡æ¨™
- âœ… éŸ³å£°å…¥åŠ›æ©Ÿèƒ½: å®Ÿè£…å®Œäº†
- âœ… åˆ†ææ©Ÿèƒ½: å®Ÿè£…å®Œäº†
- âœ… è¨­å®šç”»é¢: å®Ÿè£…å®Œäº†
- âœ… å‰ªå®šæ©Ÿèƒ½: å®Ÿè£…å®Œäº†

---

**MetaWave iOS v2.0**ã®å®Ÿè£…ãŒå®Œäº†ã—ã¾ã—ãŸï¼ğŸ‰

Miyabi Workflowæ–¹å¼ã«ã‚ˆã‚‹ä½“ç³»çš„ãªé–‹ç™ºã«ã‚ˆã‚Šã€é«˜å“è³ªã§æ‹¡å¼µæ€§ã®é«˜ã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿç¾ã•ã‚Œã¾ã—ãŸã€‚
